<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tutorial de Bloc de Notas para Android – Parte 4 | AguasNegras</title><meta name=keywords content="Android,Programación,Tutorial"><meta name=description content="Recapitulando lo anterior (hace ya 13 días a lo tonto&mldr;), se había a añadir la funcionalidad CRUD al bloc de notas, ya tengo puestos los métodos en el código del activity y solo hará falta completar.
Primero. Borrado.
El borrado habitualmente se hace mediante el menú contextual (igual que la edición, ahora que lo pienso&mldr;), para ello hay que registrar en el menú contextual el ListView, todo se puede hacer mediante métodos de la clase Activity, añadiendo al onCreate lo siguiente:"><meta name=author content="Agustín Ventura Carrasco"><link rel=canonical href=https://www.aguasnegras.es/posts/2011/08/01-tutorial-de-bloc-de-notas-para-android-parte-4/><meta name=google-site-verification content="G-W84F3CSJ3P"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.aguasnegras.es/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.aguasnegras.es/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://www.aguasnegras.es/favicon.ico><link rel=apple-touch-icon href=https://www.aguasnegras.es/favicon.ico><link rel=mask-icon href=https://www.aguasnegras.es/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-W84F3CSJ3P"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W84F3CSJ3P",{anonymize_ip:!1})}</script><meta property="og:title" content="Tutorial de Bloc de Notas para Android – Parte 4"><meta property="og:description" content="Recapitulando lo anterior (hace ya 13 días a lo tonto&mldr;), se había a añadir la funcionalidad CRUD al bloc de notas, ya tengo puestos los métodos en el código del activity y solo hará falta completar.
Primero. Borrado.
El borrado habitualmente se hace mediante el menú contextual (igual que la edición, ahora que lo pienso&mldr;), para ello hay que registrar en el menú contextual el ListView, todo se puede hacer mediante métodos de la clase Activity, añadiendo al onCreate lo siguiente:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.aguasnegras.es/posts/2011/08/01-tutorial-de-bloc-de-notas-para-android-parte-4/"><meta property="og:image" content="https://www.aguasnegras.es/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2011-08-01T00:00:00+00:00"><meta property="article:modified_time" content="2011-08-01T00:00:00+00:00"><meta property="og:site_name" content="AguasNegras"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.aguasnegras.es/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Tutorial de Bloc de Notas para Android – Parte 4"><meta name=twitter:description content="Recapitulando lo anterior (hace ya 13 días a lo tonto&mldr;), se había a añadir la funcionalidad CRUD al bloc de notas, ya tengo puestos los métodos en el código del activity y solo hará falta completar.
Primero. Borrado.
El borrado habitualmente se hace mediante el menú contextual (igual que la edición, ahora que lo pienso&mldr;), para ello hay que registrar en el menú contextual el ListView, todo se puede hacer mediante métodos de la clase Activity, añadiendo al onCreate lo siguiente:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.aguasnegras.es/posts/"},{"@type":"ListItem","position":2,"name":"Tutorial de Bloc de Notas para Android – Parte 4","item":"https://www.aguasnegras.es/posts/2011/08/01-tutorial-de-bloc-de-notas-para-android-parte-4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tutorial de Bloc de Notas para Android – Parte 4","name":"Tutorial de Bloc de Notas para Android – Parte 4","description":"Recapitulando lo anterior (hace ya 13 días a lo tonto\u0026hellip;), se había a añadir la funcionalidad CRUD al bloc de notas, ya tengo puestos los métodos en el código del activity y solo hará falta completar.\nPrimero. Borrado.\nEl borrado habitualmente se hace mediante el menú contextual (igual que la edición, ahora que lo pienso\u0026hellip;), para ello hay que registrar en el menú contextual el ListView, todo se puede hacer mediante métodos de la clase Activity, añadiendo al onCreate lo siguiente:","keywords":["Android","Programación","Tutorial"],"articleBody":"Recapitulando lo anterior (hace ya 13 días a lo tonto…), se había a añadir la funcionalidad CRUD al bloc de notas, ya tengo puestos los métodos en el código del activity y solo hará falta completar.\nPrimero. Borrado.\nEl borrado habitualmente se hace mediante el menú contextual (igual que la edición, ahora que lo pienso…), para ello hay que registrar en el menú contextual el ListView, todo se puede hacer mediante métodos de la clase Activity, añadiendo al onCreate lo siguiente:\nregisterForContextMenu(getListView()); Con esto ya podemos invocar al menú contextual desde el ListView, pero claro, estará vacío, así que hace falta rellenar el onCreateContextMenu, que es muy similar al onCreateOptionsMenu, solo que además puede interactuar con la vista que lo invoca y además acepta opciones:\npublic void onCreateContextMenu(Menu menu, View v, ContextMenu.ContextMenuInfo menuInfo) { super.onCreateContextMenu(menu, v, menuInfo); menu.add(0, DELETE_ID, 0, R.string.menu_delete); } Con esto se crea un menú contextual que contiene un único item, borrar. ¿Qué pasa cuando se pulsa un elemento del menú contextual? Pues que se ejecuta onContextItemSelected que contiene la lógica de reconocimiento del elemento y de borrado:\npublic boolean onContextItemSelected(MenuItem item) { switch(item.getItemId()) { case DELETE_ID: AdapterContextMenuInfo info = (AdapterContextMenuInfo) item.getMenuInfo(); mDbHelper.deleteNote(info.id); fillData(); return true; } return super.onContextItemSelected(item); } Aquí es especialmente importante la línea 5, si miro la documentación, ese info.id lo que devuelve es el identificador de la fila en la que se ha llamado al menú contextual, y se pasa tal cual al delete. Evidentemente en este ejemplo, se asume que ese id es el identificador de la nota también en la base de datos, pero no tiene por qué ser así… cuidado.\nPara crear una nota, se usará un Intent. En general Android funciona mediante paso de mensajes, por tanto, para crear una nota, habrá que enviar un mensaje (Intent), solicitando que se cree. Tendré esto en el createNote:\nIntent i = new Intent(this, NoteEdit.class); startActivityForResult(i, ACTIVITY_CREATE); Para crear el Intent, pasamos el Activity como implementación de Context, para dotar de un contexto de ejecución, y la clase (en este caso NoteEdit.class) que queremos que lo reciba. Tal y como insinúa la documentación, esta forma es un poco suboptima, ya que se hardcodea la clase y esto es susceptible de cambiar. La forma habitual de usar los Intent, según leo en la documentación, es declarando intent-filters en el manifest, pero de momento, así se queda.\nMás cosas, el startActivityForResult, inicia la actividad y deja la que lo invoca esperando el resultado de ella (lo apila como proceso, supongo), cuando la nueva actividad termine de ejecutar invocará al método onActivityResult() de la invocadora. La otra forma de invocar una actividad es con startActivity, que lo lanza y punto. Otra diferencia importante entre estos dos métodos, es que startActivity puede ser invocado sin existir una Activity, puede servir para crear una actividad nueva sin otra ya existente… ahí queda eso…\nCon este método tenemos completado el caso de creación de una nueva nota, ahora bien, ¿cómo se edita una nueva nota? Pues pulsando sobre ella en la lista. ¿Y qué pasa cuando se pulsa sobre ella? Pues que se ejecuta onListItemClick, que toma de parámetros, la lista en la que se hizo click, la vista dentro del ListView en la que se hizo click, la posición de la lista en la que se hizo click y por último, el identificador del elemento en el que se hizo click. El método se completaría así:\nprotected void onListItemClick(ListView l, View v, int position, long id) { super.onListItemClick(l, v, position, id); Cursor c = mNotesCursor; c.moveToPosition(position); Intent i = new Intent(this, NoteEdit.class); i.putExtra(NotesDbAdapter.KEY_ROWID, id); i.putExtra(NotesDbAdapter.KEY_TITLE, c.getString( c.getColumnIndexOrThrow(NotesDbAdapter.KEY_TITLE))); i.putExtra(NotesDbAdapter.KEY_BODY, c.getString( c.getColumnIndexOrThrow(NotesDbAdapter.KEY_BODY))); startActivityForResult(i, ACTIVITY_EDIT); } Lo primero, si mNotesCursor, es un atributo de mi actividad, ¿por qué se asigna a una variable local? Pues parece ser que por una particularidad de Dalvik, esta técnica hace que se acceda mucho más rápido al cursor, por tanto te recomiendan aplicarla siempre que puedas… vaya plan.\nA continuación se situa el cursor en el registro de base de datos que indica position (que es la posición de la nota en la lista y ha de coincidir con la posición en la base de datos… se me ocurre que esto puede dar problemas si en la base de datos se hacen borrados lógicos y no físicos) y se crea un Intent nuevo.\nEste Intent tiene un bundle interno que sirve digamos de cajón de sastre, para pasar la información que se quiera, el uso es mediante el método putExtra, y ahí se añaden todos los campos que tiene la nota.\nPor último, se lanza la Activity, pero esta vez indicándole que es una edición (ACTIVITY_EDIT). La gracia de indicar estos modos de acceso, es que se devuelven a la actividad que lo invoca en su método onActivityResult, así se puede saber de donde se viene, si de una creación o una edición.\nEl método onActivityResult recibe tres parámetros: el requestCode (es decir, el código que nosotros le hemos pasado), el resultCode (por convenio, si es distinto de 0, es correcto, tenemos un par de constantes predefinidas) y un Intent de vuelta que trae posibles resultados de la Activity recién terminada.\nEn nuestro caso, el código quedará así:\nprotected void onActivityResult(int requestCode, int resultCode, Intent intent) { super.onActivityResult(requestCode, resultCode, intent); Bundle extras = intent.getExtras(); switch(requestCode) { case ACTIVITY_CREATE: String title = extras.getString(NotesDbAdapter.KEY_TITLE); String body = extras.getString(NotesDbAdapter.KEY_BODY); mDbHelper.createNote(title, body); fillData(); break; case ACTIVITY_EDIT: Long mRowId = extras.getLong(NotesDbAdapter.KEY_ROWID); if (mRowId != null) { String editTitle = extras.getString(NotesDbAdapter.KEY_TITLE); String editBody = extras.getString(NotesDbAdapter.KEY_BODY); mDbHelper.updateNote(mRowId, editTitle, editBody); } fillData(); break; } } Haciendo un recorrido, vemos que si es un ACTIVITY_CREATE, se accede al título y el cuerpo que vienen en el Intent con los resultados, y se crea la nota a través del mDbHelper.\nSi es un ACTIVITY_EDIT, además habrá que acceder en el Intent al Id de la nota, y se procederá a actualizar. Eso es todo.\nSe puede observar que la lógica de acceso a datos queda encapsulada en esta Activity, es decir, la clase NoteEdit no va a tener lógica de acceso a base de datos, ya que es innecesario, todas las operaciones las gestiona ListActivity.\nCon esto ya esta implementada esta clase, ¿qué queda? Pues NoteEdit.java con su correspondiente layout, pero eso lo dejo para la Parte 5 :).\n","wordCount":"1045","inLanguage":"en","datePublished":"2011-08-01T00:00:00Z","dateModified":"2011-08-01T00:00:00Z","author":{"@type":"Person","name":"Agustín Ventura Carrasco"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.aguasnegras.es/posts/2011/08/01-tutorial-de-bloc-de-notas-para-android-parte-4/"},"publisher":{"@type":"Organization","name":"AguasNegras","logo":{"@type":"ImageObject","url":"https://www.aguasnegras.es/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.aguasnegras.es/ accesskey=h title="AguasNegras (Alt + H)">AguasNegras</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.aguasnegras.es/archives/ title=archivos><span>archivos</span></a></li><li><a href=https://www.aguasnegras.es/tags/ title=tags><span>tags</span></a></li><li><a href=https://www.aguasnegras.es/about/ title="acerca de"><span>acerca de</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.aguasnegras.es/>Home</a>&nbsp;»&nbsp;<a href=https://www.aguasnegras.es/posts/>Posts</a></div><h1 class=post-title>Tutorial de Bloc de Notas para Android – Parte 4</h1><div class=post-meta><span title='2011-08-01 00:00:00 +0000 UTC'>1 August 2011</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;1045 words&nbsp;·&nbsp;Agustín Ventura Carrasco&nbsp;|&nbsp;<a href=https://github.com/agustinventura.github.io/content/posts/2011/08/01-Tutorial%20de%20Bloc%20de%20Notas%20para%20Android%20%e2%80%93%20Parte%204.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Recapitulando lo anterior (hace ya 13 días a lo tonto&mldr;), se había a añadir la funcionalidad CRUD al bloc de notas, ya tengo puestos los métodos en el código del activity y solo hará falta completar.</p><p>Primero. Borrado.</p><p>El borrado habitualmente se hace mediante el menú contextual (igual que la edición, ahora que lo pienso&mldr;), para ello hay que registrar en el menú contextual el ListView, todo se puede hacer mediante métodos de la clase Activity, añadiendo al onCreate lo siguiente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>registerForContextMenu</span><span class=o>(</span><span class=n>getListView</span><span class=o>());</span>
</span></span></code></pre></div><p>Con esto ya podemos invocar al menú contextual desde el ListView, pero claro, estará vacío, así que hace falta rellenar el onCreateContextMenu, que es muy similar al onCreateOptionsMenu, solo que además puede interactuar con la vista que lo invoca y además acepta opciones:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>onCreateContextMenu</span><span class=o>(</span><span class=n>Menu</span> <span class=n>menu</span><span class=o>,</span> <span class=n>View</span> <span class=n>v</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>ContextMenu</span><span class=o>.</span><span class=na>ContextMenuInfo</span> <span class=n>menuInfo</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>.</span><span class=na>onCreateContextMenu</span><span class=o>(</span><span class=n>menu</span><span class=o>,</span> <span class=n>v</span><span class=o>,</span> <span class=n>menuInfo</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>menu</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>0</span><span class=o>,</span> <span class=n>DELETE_ID</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>R</span><span class=o>.</span><span class=na>string</span><span class=o>.</span><span class=na>menu_delete</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Con esto se crea un menú contextual que contiene un único item, borrar. ¿Qué pasa cuando se pulsa un elemento del menú contextual? Pues que se ejecuta onContextItemSelected que contiene la lógica de reconocimiento del elemento y de borrado:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onContextItemSelected</span><span class=o>(</span><span class=n>MenuItem</span> <span class=n>item</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span><span class=o>(</span><span class=n>item</span><span class=o>.</span><span class=na>getItemId</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>DELETE_ID</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>AdapterContextMenuInfo</span> <span class=n>info</span> <span class=o>=</span> <span class=o>(</span><span class=n>AdapterContextMenuInfo</span><span class=o>)</span> <span class=n>item</span><span class=o>.</span><span class=na>getMenuInfo</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>mDbHelper</span><span class=o>.</span><span class=na>deleteNote</span><span class=o>(</span><span class=n>info</span><span class=o>.</span><span class=na>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>fillData</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>onContextItemSelected</span><span class=o>(</span><span class=n>item</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Aquí es especialmente importante la línea 5, si miro la documentación, ese info.id lo que devuelve es el identificador de la fila en la que se ha llamado al menú contextual, y se pasa tal cual al delete. Evidentemente en este ejemplo, se asume que ese id es el identificador de la nota también en la base de datos, pero no tiene por qué ser así&mldr; cuidado.</p><p>Para crear una nota, se usará un Intent. En general Android funciona mediante paso de mensajes, por tanto, para crear una nota, habrá que enviar un mensaje (Intent), solicitando que se cree. Tendré esto en el createNote:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Intent</span> <span class=n>i</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Intent</span><span class=o>(</span><span class=k>this</span><span class=o>,</span> <span class=n>NoteEdit</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>startActivityForResult</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>ACTIVITY_CREATE</span><span class=o>);</span>
</span></span></code></pre></div><p>Para crear el Intent, pasamos el Activity como implementación de Context, para dotar de un contexto de ejecución, y la clase (en este caso NoteEdit.class) que queremos que lo reciba. Tal y como insinúa la documentación, esta forma es un poco suboptima, ya que se hardcodea la clase y esto es susceptible de cambiar. La forma habitual de usar los Intent, según leo en la documentación, es declarando intent-filters en el manifest, pero de momento, así se queda.</p><p>Más cosas, el startActivityForResult, inicia la actividad y deja la que lo invoca esperando el resultado de ella (lo apila como proceso, supongo), cuando la nueva actividad termine de ejecutar invocará al método onActivityResult() de la invocadora. La otra forma de invocar una actividad es con startActivity, que lo lanza y punto. Otra diferencia importante entre estos dos métodos, es que startActivity puede ser invocado sin existir una Activity, puede servir para crear una actividad nueva sin otra ya existente&mldr; ahí queda eso&mldr;</p><p>Con este método tenemos completado el caso de creación de una nueva nota, ahora bien, ¿cómo se edita una nueva nota? Pues pulsando sobre ella en la lista. ¿Y qué pasa cuando se pulsa sobre ella? Pues que se ejecuta onListItemClick, que toma de parámetros, la lista en la que se hizo click, la vista dentro del ListView en la que se hizo click, la posición de la lista en la que se hizo click y por último, el identificador del elemento en el que se hizo click. El método se completaría así:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onListItemClick</span><span class=o>(</span><span class=n>ListView</span> <span class=n>l</span><span class=o>,</span> <span class=n>View</span> <span class=n>v</span><span class=o>,</span> <span class=kt>int</span> <span class=n>position</span><span class=o>,</span> <span class=kt>long</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>.</span><span class=na>onListItemClick</span><span class=o>(</span><span class=n>l</span><span class=o>,</span> <span class=n>v</span><span class=o>,</span> <span class=n>position</span><span class=o>,</span> <span class=n>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Cursor</span> <span class=n>c</span> <span class=o>=</span> <span class=n>mNotesCursor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span><span class=o>.</span><span class=na>moveToPosition</span><span class=o>(</span><span class=n>position</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Intent</span> <span class=n>i</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Intent</span><span class=o>(</span><span class=k>this</span><span class=o>,</span> <span class=n>NoteEdit</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>.</span><span class=na>putExtra</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_ROWID</span><span class=o>,</span> <span class=n>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>.</span><span class=na>putExtra</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_TITLE</span><span class=o>,</span> <span class=n>c</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>c</span><span class=o>.</span><span class=na>getColumnIndexOrThrow</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_TITLE</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>.</span><span class=na>putExtra</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_BODY</span><span class=o>,</span> <span class=n>c</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>c</span><span class=o>.</span><span class=na>getColumnIndexOrThrow</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_BODY</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>        <span class=n>startActivityForResult</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>ACTIVITY_EDIT</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></div><p>Lo primero, si mNotesCursor, es un atributo de mi actividad, ¿por qué se asigna a una variable local? Pues parece ser que por una particularidad de Dalvik, esta técnica hace que se acceda mucho más rápido al cursor, por tanto te recomiendan aplicarla siempre que puedas&mldr; vaya plan.</p><p>A continuación se situa el cursor en el registro de base de datos que indica position (que es la posición de la nota en la lista y ha de coincidir con la posición en la base de datos&mldr; se me ocurre que esto puede dar problemas si en la base de datos se hacen borrados lógicos y no físicos) y se crea un Intent nuevo.</p><p>Este Intent tiene un bundle interno que sirve digamos de cajón de sastre, para pasar la información que se quiera, el uso es mediante el método putExtra, y ahí se añaden todos los campos que tiene la nota.</p><p>Por último, se lanza la Activity, pero esta vez indicándole que es una edición (ACTIVITY_EDIT). La gracia de indicar estos modos de acceso, es que se devuelven a la actividad que lo invoca en su método onActivityResult, así se puede saber de donde se viene, si de una creación o una edición.</p><p>El método onActivityResult recibe tres parámetros: el requestCode (es decir, el código que nosotros le hemos pasado), el resultCode (por convenio, si es distinto de 0, es correcto, tenemos un par de constantes predefinidas) y un Intent de vuelta que trae posibles resultados de la Activity recién terminada.</p><p>En nuestro caso, el código quedará así:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onActivityResult</span><span class=o>(</span><span class=kt>int</span> <span class=n>requestCode</span><span class=o>,</span> <span class=kt>int</span> <span class=n>resultCode</span><span class=o>,</span> <span class=n>Intent</span> <span class=n>intent</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    	<span class=kd>super</span><span class=o>.</span><span class=na>onActivityResult</span><span class=o>(</span><span class=n>requestCode</span><span class=o>,</span> <span class=n>resultCode</span><span class=o>,</span> <span class=n>intent</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	<span class=n>Bundle</span> <span class=n>extras</span> <span class=o>=</span> <span class=n>intent</span><span class=o>.</span><span class=na>getExtras</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    	<span class=k>switch</span><span class=o>(</span><span class=n>requestCode</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    	<span class=k>case</span> <span class=n>ACTIVITY_CREATE</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    	    <span class=n>String</span> <span class=n>title</span> <span class=o>=</span> <span class=n>extras</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_TITLE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	    <span class=n>String</span> <span class=n>body</span> <span class=o>=</span> <span class=n>extras</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_BODY</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	    <span class=n>mDbHelper</span><span class=o>.</span><span class=na>createNote</span><span class=o>(</span><span class=n>title</span><span class=o>,</span> <span class=n>body</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	    <span class=n>fillData</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    	    <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    	<span class=k>case</span> <span class=n>ACTIVITY_EDIT</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    	    <span class=n>Long</span> <span class=n>mRowId</span> <span class=o>=</span> <span class=n>extras</span><span class=o>.</span><span class=na>getLong</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_ROWID</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	    <span class=k>if</span> <span class=o>(</span><span class=n>mRowId</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    	        <span class=n>String</span> <span class=n>editTitle</span> <span class=o>=</span> <span class=n>extras</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_TITLE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	        <span class=n>String</span> <span class=n>editBody</span> <span class=o>=</span> <span class=n>extras</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=n>NotesDbAdapter</span><span class=o>.</span><span class=na>KEY_BODY</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	        <span class=n>mDbHelper</span><span class=o>.</span><span class=na>updateNote</span><span class=o>(</span><span class=n>mRowId</span><span class=o>,</span> <span class=n>editTitle</span><span class=o>,</span> <span class=n>editBody</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	    <span class=o>}</span>
</span></span><span class=line><span class=cl>    	    <span class=n>fillData</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    	    <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    	<span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></div><p>Haciendo un recorrido, vemos que si es un ACTIVITY_CREATE, se accede al título y el cuerpo que vienen en el Intent con los resultados, y se crea la nota a través del mDbHelper.</p><p>Si es un ACTIVITY_EDIT, además habrá que acceder en el Intent al Id de la nota, y se procederá a actualizar. Eso es todo.</p><p>Se puede observar que la lógica de acceso a datos queda encapsulada en esta Activity, es decir, la clase NoteEdit no va a tener lógica de acceso a base de datos, ya que es innecesario, todas las operaciones las gestiona ListActivity.</p><p>Con esto ya esta implementada esta clase, ¿qué queda? Pues NoteEdit.java con su correspondiente layout, pero eso lo dejo para la Parte 5 :).</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.aguasnegras.es/tags/android/>Android</a></li><li><a href=https://www.aguasnegras.es/tags/programaci%C3%B3n/>Programación</a></li><li><a href=https://www.aguasnegras.es/tags/tutorial/>Tutorial</a></li></ul><nav class=paginav><a class=prev href=https://www.aguasnegras.es/posts/2011/08/02-tutorial-de-bloc-de-notas-para-android-parte-5/><span class=title>« Prev</span><br><span>Tutorial de Bloc de Notas para Android - Parte 5</span></a>
<a class=next href=https://www.aguasnegras.es/posts/2011/07/12-tutorial-de-bloc-de-notas-para-android-parte-3/><span class=title>Next »</span><br><span>Tutorial de Bloc de Notas para Android - Parte 3</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Tutorial de Bloc de Notas para Android – Parte 4 on twitter" href="https://twitter.com/intent/tweet/?text=Tutorial%20de%20Bloc%20de%20Notas%20para%20Android%20%e2%80%93%20Parte%204&url=https%3a%2f%2fwww.aguasnegras.es%2fposts%2f2011%2f08%2f01-tutorial-de-bloc-de-notas-para-android-parte-4%2f&hashtags=Android%2cProgramaci%c3%b3n%2cTutorial"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tutorial de Bloc de Notas para Android – Parte 4 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.aguasnegras.es%2fposts%2f2011%2f08%2f01-tutorial-de-bloc-de-notas-para-android-parte-4%2f&title=Tutorial%20de%20Bloc%20de%20Notas%20para%20Android%20%e2%80%93%20Parte%204&summary=Tutorial%20de%20Bloc%20de%20Notas%20para%20Android%20%e2%80%93%20Parte%204&source=https%3a%2f%2fwww.aguasnegras.es%2fposts%2f2011%2f08%2f01-tutorial-de-bloc-de-notas-para-android-parte-4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tutorial de Bloc de Notas para Android – Parte 4 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.aguasnegras.es%2fposts%2f2011%2f08%2f01-tutorial-de-bloc-de-notas-para-android-parte-4%2f&title=Tutorial%20de%20Bloc%20de%20Notas%20para%20Android%20%e2%80%93%20Parte%204"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tutorial de Bloc de Notas para Android – Parte 4 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.aguasnegras.es%2fposts%2f2011%2f08%2f01-tutorial-de-bloc-de-notas-para-android-parte-4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tutorial de Bloc de Notas para Android – Parte 4 on whatsapp" href="https://api.whatsapp.com/send?text=Tutorial%20de%20Bloc%20de%20Notas%20para%20Android%20%e2%80%93%20Parte%204%20-%20https%3a%2f%2fwww.aguasnegras.es%2fposts%2f2011%2f08%2f01-tutorial-de-bloc-de-notas-para-android-parte-4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tutorial de Bloc de Notas para Android – Parte 4 on telegram" href="https://telegram.me/share/url?text=Tutorial%20de%20Bloc%20de%20Notas%20para%20Android%20%e2%80%93%20Parte%204&url=https%3a%2f%2fwww.aguasnegras.es%2fposts%2f2011%2f08%2f01-tutorial-de-bloc-de-notas-para-android-parte-4%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.aguasnegras.es/>AguasNegras</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>